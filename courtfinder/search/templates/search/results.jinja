{% extends "layout/base.jinja" %}
{% load static %}

{% block page_title %}Find a court or tribunal{% endblock %}

{% block content %}
<div class="content inner cf">
  <header class="page-header">
    <h1>Find a court or tribunal</h1>
  </header>

  {% if error %}
  <p>{{ error }}</p>
  {% else %}

  {% if search_results %}
  <div class="search-results">
    {% if query %}
    <p class="text-secondary">
      <span id="number-of-results">{{ search_results|length }}</span> result{{ search_results|length|pluralize }}
    </p>
    {% else %}
      {% if search_results|length == 1 %}
    <p>This is the court or tribunal nearest {{ postcode }}:</p>
      {% else %}
    <p>These are the <span id="number-of-results">{{ search_results|length }}</span> courts or tribunals nearest {{ postcode }}:</p>
      {% endif %}
    {% endif %}
    <hr/>
    <ul id='court-results'>
      {% for court in search_results %}
      <li>
        <div class="court-link">
          <a href="https://courttribunalfinder.service.gov.uk/courts/{{ court.slug }}">{{ court.name }}</a>
        </div>
        <div class="court-addresses">
          <p>
            <span class="court-result-heading">Write to us:</span><br/>
            {% with a=court.address %}
            <span class="court-address">
            {% for line in a.address_lines %}
              {% if line != "" %}
                {{ line }}<br/>
              {% endif %}
              {% endfor %}
            </span>
            <span class="court-town">{{a.town}}</span><br/>
            <span class="court-postcode">{{a.postcode}}</span>
            {% endwith %}
          </p>

          <p>
            {% if court.dx_number %}
              <span class="court-result-heading">DX:</span> <span>{{ court.dx_number }}</span><br/>
            {% endif %}
            {% if court.number %}
              <span class="court-result-heading">Court number:</span> <span>{{ court.number }}</span>
            {% endif %}
          </p>
        </div>
        <div class="court-aol">
          <p class="court-result-heading">This court or tribunal deals with the following legal problems:</p>
          <ul>
          {% for aol in court.areas_of_law %}
            <li>{{ aol.name }}</li>
          {% endfor %}
          </ul>
        </div>
        <div class="court-map">
          {% if court.distance %}
          <p class="distance-from-postcode">{{ court.distance }} miles away</p>
          {% endif %}
          <p>
            <a target="_blank" href="https://maps.google.com/maps?q={{court.lat}},{{court.lon}}">
              <img src="http://maps.googleapis.com/maps/api/staticmap?size=290x235&zoom=15&markers={{court.lat}},{{court.lon}}&key=AIzaSyC_b504UmVatMNUg1HCmbyuXoJ8meK6lpA" alt="location of the court on a map"/>
            </a>
          </p>
        </div>
        <hr class="clear"/>
      </li>
      {% endfor %}
    </ul>
  </div>
  {% else %}
    {% if query %}
  <section class="validation-error">
    Sorry, there are no results for {{ query }}. Please check and try another name or addresss.
  </section>
    {% endif %}
    {% if postcode %}
  <section class="postcode-error validation-error">
    Sorry, your postcode <strong>{{ postcode }}</strong> has not been found.<br />
    Please check if any letters or numbers are missing.
  </section>
    {% endif %}
  {% endif %}
  {% endif %}
    <form method="get" action="results">
    {% if query %}
    <label for="postcode" class="form-block">
      <div class="form-label-bold">Search by name or address</div>
      <div class="form-hint">Enter part of the court or tribunal name or address.</div>
      <input class="form-control" type="text" name="q" />
    </label>
    {% else %}
    <div class="form-block">
      <label for="postcode">
        <div class="form-label-bold">Search by postcode</div>
        <div class="form-hint">Use full or part postcodes, for example, SW1 8LH or SW1.</div>
        <input type="text" name="postcode" value="{{ postcode|default:'' }}" />
      </label>
    </div>
    <div class="form-block">
      <div class="form-label-bold">Filter by legal problem</div>
      <div class="form-hint">Not all courts deal with all legal problems. Filtering will help you find the right court more easily.</div>
      <label for="aol-0" class="block-label form-block">
        <input id="aol-0" type="radio" name="area_of_law" value="All" checked=checked>
        <div class="form-label">All courts and tribunals</div>
      </label>
      <label for="aol-one" class="block-label form-block" id="aol-one-label">
        <input id="aol-one" type="radio" name="area_of_law" value="unselected">
        <div class="form-label">Only those dealing with your legal problem</div>
      </label>
      <div id="aols" class="form-block">
        <div id="aol-hint" class="form-hint">Choose the problem area that is relevant to you.</div>
        {% for aol in areas_of_law %}
        <label for="aol-{{forloop.counter}}" class="block-label form-block aol-label">
          <input id="aol-{{forloop.counter}}" type="radio" name="area_of_law" value="{{aol.name}}" >
          <div class="form-label">
            {{aol.name}}
            <span class="aol-description">{{ aol.description }}</span>
          </div>
        </label>
        {% endfor %}
      </div>
    </div>
    {% endif %}
    <div class="actions">
      <button id="again" class="button" type="submit">Search again</button>
    </div>
  </form>
</div>
{% endblock %}
{% block javascripts %}
    <script src='{% static "javascripts/application.js" %}'></script>
{% endblock %}
