{% extends "layout/base.jinja" %}
{% block page_title %}Find a court or tribunal{% endblock %}

{% block content %}
<div class="content inner cf">
  <header class="page-header">
    <h1>Find a court or tribunal</h1>
  </header>

  {% if error %}
  <p>{{ error }}</p>
  {% else %}

  {% if search_results %}
  <div class="search-results">
    {% if query %}
    <p class="text-secondary">
      <span id="number-of-results">{{ search_results|length }}</span> results
    </p>
    {% else %}
    <p>These are the <span id="number-of-results">{{ search_results|length }}</span> courts or tribunals nearest the postcode: {{ postcode }}</p>
    {% endif %}
    <hr/>
    <ul id='court-results'>
      {% for court in search_results %}
      <li>
        <div class="court-link">
          <a href="https://courttribunalfinder.service.gov.uk/courts/{{ court.slug }}">{{ court.name }}</a>
        </div>
        <div class="court-addresses">
          <p vocab="http://schema.org/" typeof="Courthouse">
            <span class="court-result-heading">Write to us:</span><br/>
            {% with a=court.address %}
            <span class="court-address">
            {% for line in a.address_lines %}
              {% if line != "" %}
                {{ line }}<br/>
              {% endif %}
              {% endfor %}
            </span>
            <span class="court-town">{{a.town}}</span><br/>
            <span class="court-postcode">{{a.postcode}}</span>
            {% endwith %}
          </p>

          <p>
            {% if court.dx_number %}
              <span class="court-result-heading">DX:</span> <span>{{ court.dx_number }}</span><br/>
            {% endif %}
            {% if court.number %}
              <span class="court-result-heading">Court number:</span> <span>{{ court.number }}</span>
            {% endif %}
          </p>
        </div>
        <div class="court-aol">
          <p class="court-result-heading">This court or tribunal deals with the following legal problems:</p>
          <ul>
          {% for aol in court.areas_of_law %}
            <li><span {% if aol.name == area_of_law %}class="selected-aol"{% endif %}>{{ aol.name }}</span></li>
          {% endfor %}
          </ul>
        </div>
        <div class="court-map">
          {% if court.distance %}
          <p class="distance-from-postcode">{{ court.distance }} miles away</p>
          {% endif %}
          <p>
            <a target="_blank" href="https://maps.google.com/maps?q={{court.lat}},{{court.lon}}">
              <img src="http://maps.googleapis.com/maps/api/staticmap?size=290x235&zoom=15&markers={{court.lat}},{{court.lon}}&key=AIzaSyC_b504UmVatMNUg1HCmbyuXoJ8meK6lpA" alt="location of the court on a map"/>
            </a>
          </p>
        </div>
        <hr class="clear"/>
      </li>
      {% endfor %}
    </ul>
  </div>
  {% else %}
    {% if query %}
      <p>Sorry, there are no results for {{ query }}. Please check and try another name or addresss.</p>
    {% endif %}
    {% if postcode %}
      <p>Sorry, there are no results for {{ postcode }}. Please check and try another postcode.</p>
    {% endif %}
  {% endif %}
  {% endif %}
    <form method="get" action="results">
    {% if query %}
    <label for="postcode" class="form-block">
      <div class="form-label-bold">Search by name or address</div>
      <div class="form-hint">Enter part of the court or tribunal name or address.</div>
      <input class="form-control" type="text" name="q" />
    </label>
    {% else %}
    <label for="postcode" class="form-block">
      <div class="form-label-bold">Search results for postcode</div>
      <input type="text" name="postcode" value="{{ postcode }}"/>
    </label>
    <label for="area_of_law" class="form-block">
      <div class="form-label-bold">Filtered by courts or tribunals dealing with</div>
      <select name="area_of_law" id="area_of_law">
        <option value="All" {% if aol.name == "All" %}selected=selected{% endif %}>All courts and tribunals</option>
        {% for aol in areas_of_law %}
        <option value="{{aol.name}}" {% if aol.name == area_of_law %}selected=selected{% endif %}>{{ aol.name }}</option>
        {% endfor %}
      </select>
    </label>
    {% endif %}
    <div class="actions">
      <button id="again" class="button" type="submit">Search again</button>
    </div>
  </form>

</div>
{% endblock %}
